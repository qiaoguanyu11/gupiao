from src.data.stock_manager import StockManager
from datetime import datetime

# 股票列表
stocks = [
    ("605069", "正和生态", 12.91),
    ("603072", "天和磁材", 50.38),
    ("301082", "久盛电气", 18.07),
    ("301079", "邵阳液压", 37.08),
    ("001382", "C新亚", 25.72),
    ("002278", "神开股份", 11.56),
    ("688757", "C胜科", 24.49),
    ("300611", "美力科技", 32.76),
    ("603280", "南方路机", 26.90),
    ("001318", "阳光乳业", 14.33),
    ("002165", "红宝丽", 6.07),
    ("301629", "C矽电", 158.50),
    ("603124", "C江南", 49.39),
    ("301601", "惠通科技", 37.46),
    ("300963", "中洲特材", 11.96),
    ("002255", "海陆重工", 8.02),
    ("002735", "王子新材", 10.52),
    ("301137", "哈焊华通", 27.10),
    ("002553", "南方精工", 27.94),
    ("300721", "怡达股份", 17.58),
    ("002767", "先锋电子", 21.46),
    ("002903", "宇环数控", 20.62),
    ("002570", "贝因美", 5.28),
    ("301396", "宏景科技", 78.39),
    ("002366", "融发核电", 5.67),
    ("300084", "海默科技", 8.55),
    ("600243", "青海华鼎", 3.04),
    ("002406", "远东传动", 8.34),
    ("002861", "瀛通通讯", 15.87),
    ("300065", "海兰信", 18.25),
    ("600727", "鲁北化工", 9.07),
    ("603028", "赛福天", 7.28),
    ("300885", "海昌新材", 17.98),
    ("002204", "大连重工", 8.57),
    ("301289", "国缆检测", 58.60),
    ("300971", "博亚精工", 29.05),
    ("002639", "雪人股份", 8.64),
    ("301212", "联盛化学", 26.73),
    ("600101", "明星电力", 11.84),
    ("300961", "深水海纳", 19.50),
    ("300198", "纳川股份", 2.92),
    ("301279", "金道科技", 28.15),
    ("300817", "双飞集团", 28.99),
    ("300067", "安诺其", 7.32),
    ("603359", "东珠生态", 6.43),
    ("002655", "共达电声", 15.50),
    ("300180", "华峰超纤", 7.63),
    ("603285", "钢研股份", 29.16),
    ("300353", "东土科技", 20.72),
    ("600470", "六国化工", 7.07)
]

def main():
    """添加股票到数据库"""
    print("开始添加股票到数据库...")
    success_count = 0
    fail_count = 0
    
    # 设置统一的入手日期
    entry_date = datetime(2025, 3, 23)
    
    # 获取数据库连接
    conn = StockManager.get_db_connection()
    cursor = conn.cursor()
    
    try:
        for code, name, price in stocks:
            try:
                # 计算实际成本（入手价格 * 100.04%）
                actual_cost = price * 1.0004
                # 计算总实际成本（实际成本 * 股票数量）
                total_cost = actual_cost * 10000
                
                # 添加到stocks表
                cursor.execute("""
                    INSERT INTO stocks (code, cost, quantity, total_cost, register_date)
                    VALUES (%s, %s, %s, %s, %s)
                """, (code, actual_cost, 10000, total_cost, entry_date))
                
                # 添加到stock_info表
                cursor.execute("""
                    INSERT INTO stock_info (code, name, current_price, update_time)
                    VALUES (%s, %s, %s, NOW())
                """, (code, name, price))
                
                conn.commit()
                success_count += 1
                print(f"成功添加: {code} {name} 价格: {price}")
                
            except Exception as e:
                conn.rollback()
                fail_count += 1
                print(f"添加失败: {code} {name} 原因: {str(e)}")
                
    finally:
        cursor.close()
        conn.close()
    
    print(f"\n添加完成！成功: {success_count} 失败: {fail_count}")

if __name__ == "__main__":
    main() 